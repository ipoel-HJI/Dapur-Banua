<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <title>Admin Dapur Banua - Manajemen Foto & Keterangan</title>

  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet"/>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css"/>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>

  <style>
    body { padding-top: 70px; }
    .card-img-top { height: 160px; object-fit: cover; }
    .thumb { height: 120px; object-fit: cover; border-radius: 6px; border:1px solid #ddd; }
    .certificate-img { height: 120px; object-fit: cover; border-radius:6px; }
    .caption-small { font-size: 0.88rem; color:#495057; margin-top:6px; }
    .small-muted { font-size:0.85rem; color:#6c757d; }
    .table-sm td, .table-sm th { padding:0.4rem !important; vertical-align:top; }
	
  </style>
</head>
<body>
  <nav class="navbar navbar-dark bg-dark fixed-top">
    <div class="container">
      <a class="navbar-brand">Admin Dapur Banua</a>
      <button id="logoutBtn" class="btn btn-outline-light btn-sm">Logout</button>
    </div>
  </nav>

  <div class="container mt-4">
    <div id="alertArea"></div>

      <!-- Form Input Menu Hari Ini -->
    <div class="card mb-4 shadow-sm">
      <div class="card-header bg-danger text-white">
        <i class="fas fa-clipboard-list"></i> Tambah / Ubah Menu Hari Ini
      </div>
      <div class="card-body">
        <form id="menuForm" class="row g-3">
          <div class="col-md-2">
            <select id="waktuMakan" class="form-select" required>
              <option value="">Pilih Waktu</option>
              <option value="Pagi">Pagi</option>
              <option value="Siang">Siang</option>
              <option value="Malam">Malam</option>
            </select>
          </div>
          <div class="col-md-2">
            <input id="jenisNasi" class="form-control" placeholder="Jenis Nasi" required>
          </div>
          <div class="col-md-2">
            <input id="lauk" class="form-control" placeholder="Lauk Utama" required>
          </div>
          <div class="col-md-3">
            <input id="laukTambahan" class="form-control" placeholder="Lauk Tambahan" required>
          </div>
          <div class="col-md-3">
            <input id="sayur" class="form-control" placeholder="Sayur" required>
          </div>
          <div class="col-12">
            <button class="btn btn-danger w-100" type="submit">
              <i class="fas fa-save"></i> Simpan Menu Hari Ini
            </button>
          </div>
        </form>
      </div>
    </div>

    <!-- Riwayat 31 Hari -->
    <div class="card shadow-sm">
      <div class="card-header bg-secondary text-white d-flex justify-content-between align-items-center">
        <div><i class="fas fa-history"></i> Riwayat Menu 31 Hari Terakhir</div>
        <button class="btn btn-light btn-sm" data-bs-toggle="collapse" data-bs-target="#riwayatSection">
          <i class="fas fa-eye"></i> Tampilkan / Sembunyikan
        </button>
      </div>
      <div id="riwayatSection" class="collapse show">
        <div class="card-body table-responsive">
          <table class="table table-bordered table-striped align-middle">
            <thead class="table-light">
              <tr style="width:120px;" class="text-center">
                <th>Tanggal</th>
                <th>Waktu</th>
                <th>Jenis Nasi</th>
                <th >Lauk</th>
                <th>Lauk Tambahan</th>
                <th>Sayur</th>
                <th style="width:120px;" class="text-center">Aksi</th>
              </tr>
            </thead>
            <tbody id="riwayatBody"></tbody>
          </table>
        </div>
      </div>
    </div>
  </div>
  
    <!-- Foto Menu (dengan keterangan) -->
    <div class="card mb-4">
      <div class="card-header bg-warning d-flex justify-content-between align-items-center">
        <div><i class="fas fa-utensils"></i> Manajemen Foto Menu</div>
        <button class="btn btn-light btn-sm" data-bs-toggle="collapse" data-bs-target="#menuFotoSection">Tampilkan / Sembunyikan</button>
      </div>
      <div id="menuFotoSection" class="collapse hide">
        <div class="card-body">
          <form id="fotoMenuForm" class="row g-3">
            <div class="col-md-6"><input type="file" id="fotoMenuFile" accept="image/*" class="form-control" required></div>
            <div class="col-md-6"><textarea id="fotoMenuCaption" class="form-control" placeholder="Keterangan foto (deskripsi / nama menu)..." rows="2"></textarea></div>
            <div class="col-md-12"><button class="btn btn-warning mt-2" type="submit">Tambah Foto Menu</button></div>
          </form>
          <hr>
          <div id="fotoMenuList" class="row row-cols-1 row-cols-md-4 g-3"></div>
        </div>
      </div>
    </div>

    <!-- Dokumentasi Kegiatan (dengan keterangan) -->
    <div class="card mb-4">
      <div class="card-header bg-info d-flex justify-content-between align-items-center text-white">
        <div><i class="fas fa-camera-retro"></i> Manajemen Dokumentasi Kegiatan Dapur & Kantin</div>
        <button class="btn btn-light btn-sm" data-bs-toggle="collapse" data-bs-target="#kegiatanSection">Tampilkan / Sembunyikan</button>
      </div>
      <div id="kegiatanSection" class="collapse hide">
        <div class="card-body">
          <form id="fotoKegiatanForm" class="row g-3">
            <div class="col-md-6"><input type="file" id="fotoKegiatanFile" accept="image/*" class="form-control" required></div>
            <div class="col-md-6"><textarea id="fotoKegiatanCaption" class="form-control" placeholder="Keterangan foto kegiatan..." rows="2"></textarea></div>
            <div class="col-md-12"><button class="btn btn-info mt-2" type="submit">Tambah Foto Kegiatan</button></div>
          </form>
          <hr>
          <div id="fotoKegiatanList" class="row row-cols-1 row-cols-md-4 g-3"></div>
        </div>
      </div>
    </div>

    <!-- Sertifikat (dengan keterangan) -->
    <div class="card mb-4">
      <div class="card-header bg-success text-white d-flex justify-content-between align-items-center">
        <div><i class="fas fa-certificate"></i> Manajemen Sertifikat Dapur</div>
        <button class="btn btn-light btn-sm" data-bs-toggle="collapse" data-bs-target="#sertifikatSection">Tampilkan / Sembunyikan</button>
      </div>
      <div id="sertifikatSection" class="collapse hide">
        <div class="card-body">
          <form id="sertifikatForm" class="row g-3">
            <div class="col-md-6"><input type="file" id="fotoSertifikat" accept="image/*" class="form-control" required></div>
            <div class="col-md-6"><textarea id="fotoSertifikatCaption" class="form-control" placeholder="Keterangan sertifikat..." rows="2"></textarea></div>
            <div class="col-md-12"><button class="btn btn-success mt-2" type="submit">Tambah Sertifikat</button></div>
          </form>
          <hr>
          <div id="sertifikatList" class="row row-cols-1 row-cols-md-4 g-3"></div>
        </div>
      </div>
    </div>

    <!-- Waitress -->
    <div class="card mb-4">
      <div class="card-header bg-secondary text-white d-flex justify-content-between align-items-center">
        <div><i class="fas fa-user-tie"></i> Manajemen Waitress</div>
        <button class="btn btn-light btn-sm" data-bs-toggle="collapse" data-bs-target="#waitressSection">Tampilkan / Sembunyikan</button>
      </div>
      <div id="waitressSection" class="collapse hide">
        <div class="card-body">
          <form id="waitressForm" class="row g-3 align-items-center">
            <div class="col-md-3"><input id="namaWaitress" class="form-control" placeholder="Nama Waitress" required></div>
            <div class="col-md-4"><input type="file" id="fotoWaitress" accept="image/*" class="form-control" required></div>
            <div class="col-md-2"><button class="btn btn-secondary w-100" type="submit">Tambah Waitress</button></div>
          </form>
          <hr>
          <div id="waitressList" class="row row-cols-1 row-cols-md-4 g-3"></div>
        </div>
      </div>
    </div>

    <!-- Anggota dapur -->
    <div class="card mb-4">
      <div class="card-header bg-primary text-white">Manajemen Anggota Dapur Banua</div>
      <div class="card-body">
        <form id="anggotaForm" class="row g-3 align-items-center">
          <div class="col-md-3"><input id="namaAnggota" class="form-control" placeholder="Nama Anggota" required></div>
          <div class="col-md-3">
            <select id="jabatanAnggota" class="form-control" required>
              <option value="">Pilih Jabatan</option>
              <option value="Kepala Dapur">Kepala Dapur</option>
              <option value="Koki">Koki</option>
              <option value="Asisten Koki">Asisten Koki</option>
              <option value="Helper">Helper</option>
			  <option value="Cake">Cake</option>
            </select>
          </div>
          <div class="col-md-4"><input type="file" id="fotoAnggota" accept="image/*" class="form-control" required></div>
          <div class="col-md-2"><button class="btn btn-primary w-100" type="submit">Tambah Anggota</button></div>
        </form>
        <hr>
        <div id="anggotaList" class="row row-cols-1 row-cols-md-4 g-3"></div>
      </div>
    </div>

    <!-- Keluhan -->
    <div class="card mb-5">
	
				<div class="card-header bg-success text-white d-flex justify-content-between align-items-center">
				<div><i class="fas fa-list"></i> Keluhan </div>
				<button class="btn btn-light btn-sm" data-bs-toggle="collapse" data-bs-target="#keluhan">Tampilkan / Sembunyikan</button>
				</div>
				<div id="keluhan" class="collapse hide">
		<div class="card-body">
			<div class="row">
				<div class="col-md-6">
					<h6>Keluhan Masuk</h6>
					<ul id="keluhanList" class="list-group mb-3"></ul>
				</div>
				<div class="col-md-6">
					<h6>Keluhan Selesai</h6>
					<ul id="keluhanSelesaiList" class="list-group"></ul>
				</div>
			</div>
		</div>
    </div>
	
	<!-- Request Menu Konsumen -->
	<div class="card mb-6">
				<div class="card-header bg-success text-white d-flex justify-content-between align-items-center">
				<div><i class="fas fa-list"></i> Request Menu Konsumen</div>
				<button class="btn btn-light btn-sm" data-bs-toggle="collapse" data-bs-target="#requestMenuSection">Tampilkan / Sembunyikan</button>
				</div>
		<div id="requestMenuSection" class="collapse hide">
			<div class="card-body table-responsive">
				<table class="table table-bordered table-sm">
					<thead class="table-light">
						<tr>
						<th>Tanggal</th>
						<th>waktu</th>
						<th>Lauk</th>
						<th>Nasi</th>
						<th>Lauk Tambahan</th>
						<th>Sayur</th>
						<th style="width:120px;" class="text-center">Aksi</th>
						</tr>
					</thead>
						<tbody id="requestMenuTableBody"></tbody>
				</table>
			</div>
		</div>
	</div>

 </div>

  <footer class="text-center py-3">© 2025 Dapur Banua - Admin</footer>

  <script>
    // Guard login
    if (!localStorage.getItem('isLoggedIn')) location = 'index.html';

    function showAlert(msg, type='success') {
      const a = document.createElement('div');
      a.className = `alert alert-${type} alert-dismissible fade show`;
      a.innerHTML = `${msg} <button class="btn-close" data-bs-dismiss="alert"></button>`;
      document.getElementById('alertArea').appendChild(a);
      setTimeout(()=>a.remove(), 3000);
    }

    // load data
    let fotoMenuData = JSON.parse(localStorage.getItem('fotoMenuData')) || []; // {foto, keterangan}
    let fotoKegiatanData = JSON.parse(localStorage.getItem('fotoKegiatanData')) || []; // {foto, keterangan}
    let sertifikatData = JSON.parse(localStorage.getItem('sertifikatData')) || []; // {foto, keterangan}
    let anggotaData = JSON.parse(localStorage.getItem('anggotaData')) || [];
    let waitressData = JSON.parse(localStorage.getItem('waitressData')) || [];
    let keluhanList = JSON.parse(localStorage.getItem('keluhanList')) || [];
    let keluhanSelesai = JSON.parse(localStorage.getItem('keluhanSelesai')) || [];

    // ensure 2 waitress placeholders
    if (!waitressData || !waitressData.length) {
      waitressData = [
        { nama: 'Waitress A', foto: null },
        { nama: 'Waitress B', foto: null }
      ];
      localStorage.setItem('waitressData', JSON.stringify(waitressData));
    }

    // helper convert file to dataURL
    function fileToDataURL(file, cb) {
      const r = new FileReader();
      r.onload = e => cb(e.target.result);
      r.readAsDataURL(file);
    }

    let menuData = JSON.parse(localStorage.getItem('menuData')) || [];

    function showAlert(msg, type='success') {
      const alert = document.createElement('div');
      alert.className = `alert alert-${type} alert-dismissible fade show`;
      alert.innerHTML = `${msg} <button class="btn-close" data-bs-dismiss="alert"></button>`;
      document.getElementById('alertArea').appendChild(alert);
      setTimeout(()=>alert.remove(), 3000);
    }

    // Simpan menu hari ini
    document.getElementById('menuForm').addEventListener('submit', e=>{
      e.preventDefault();
      const menu = {
        tanggal: new Date().toISOString().split('T')[0],
        waktu: document.getElementById('waktuMakan').value,
        nasi: document.getElementById('jenisNasi').value.trim(),
        lauk: document.getElementById('lauk').value.trim(),
        laukTambahan: document.getElementById('laukTambahan').value.trim(),
        sayur: document.getElementById('sayur').value.trim()
      };

      // jika sudah ada menu hari ini dengan waktu sama, update saja
      const idx = menuData.findIndex(m => m.tanggal === menu.tanggal && m.waktu === menu.waktu);
      if(idx >= 0) menuData[idx] = menu;
      else menuData.unshift(menu);

      // hapus data lebih dari 31 hari
      const batas = new Date();
      batas.setDate(batas.getDate() - 31);
      menuData = menuData.filter(m => new Date(m.tanggal) >= batas);

      localStorage.setItem('menuData', JSON.stringify(menuData));
      showAlert('Menu hari ini disimpan!');
      renderRiwayat();
      e.target.reset();
    });

    function renderRiwayat(){
      const tbody = document.getElementById('riwayatBody');
      if(!menuData.length) {
        tbody.innerHTML = `<tr><td colspan="7" class="text-center text-muted">Belum ada data menu.</td></tr>`;
        return;
      }
      tbody.innerHTML = menuData.map((m,i)=>`
        <tr>
          <td>${m.tanggal}</td>
          <td>${m.waktu}</td>
          <td>${m.nasi}</td>
          <td>${m.lauk}</td>
          <td>${m.laukTambahan}</td>
          <td>${m.sayur}</td>
          <td class="text-center">
            <button class="btn btn-warning btn-sm me-1" onclick="editMenu(${i})"><i class="fas fa-edit"></i></button>
            <button class="btn btn-danger btn-sm" onclick="hapusMenu(${i})"><i class="fas fa-trash"></i></button>
          </td>
        </tr>
      `).join('');
    }

    function editMenu(i){
      const m = menuData[i];
      const waktu = prompt("Ubah Waktu (Pagi/Siang/Malam):", m.waktu);
      const nasi = prompt("Ubah Jenis Nasi:", m.nasi);
      const lauk = prompt("Ubah Lauk:", m.lauk);
      const tambahan = prompt("Ubah Lauk Tambahan:", m.laukTambahan);
      const sayur = prompt("Ubah Sayur:", m.sayur);
      if(!waktu || !nasi || !lauk || !sayur) return;
      menuData[i] = { ...m, waktu, nasi, lauk, laukTambahan: tambahan, sayur };
      localStorage.setItem('menuData', JSON.stringify(menuData));
      renderRiwayat();
      showAlert('Data menu diperbarui!', 'info');
    }

    function hapusMenu(i){
      if(!confirm('Hapus menu ini?')) return;
      menuData.splice(i,1);
      localStorage.setItem('menuData', JSON.stringify(menuData));
      renderRiwayat();
      showAlert('Data menu dihapus!', 'warning');
    }

    // ---------- FOTO MENU (dgn keterangan) ----------
    const fotoMenuForm = document.getElementById('fotoMenuForm');
    fotoMenuForm.addEventListener('submit', e => {
      e.preventDefault();
      const f = document.getElementById('fotoMenuFile').files[0];
      const k = document.getElementById('fotoMenuCaption').value.trim();
      if (!f) return alert('Pilih file foto menu');
      fileToDataURL(f, data => {
        fotoMenuData.unshift({ foto: data, keterangan: k });
        localStorage.setItem('fotoMenuData', JSON.stringify(fotoMenuData));
        renderFotoMenu();
        fotoMenuForm.reset();
        showAlert('Foto menu ditambahkan');
      });
    });

    function renderFotoMenu() {
      const el = document.getElementById('fotoMenuList');
      if (!fotoMenuData.length) { el.innerHTML = '<p class="text-muted">Belum ada foto menu.</p>'; return; }
      el.innerHTML = fotoMenuData.map((f,i) =>
        `<div class="col text-center">
           <img src="${f.foto}" class="thumb mb-2" alt="Foto Menu ${i+1}">
           <div class="caption-small text-center">${escapeHtml(f.keterangan || '')}</div>
           <div class="mt-2">
             <button class="btn btn-sm btn-warning me-1" onclick="gantiFotoMenu(${i})">Ganti</button>
             <button class="btn btn-sm btn-secondary me-1" onclick="editCaptionFotoMenu(${i})">Edit Keterangan</button>
             <button class="btn btn-sm btn-danger" onclick="hapusFotoMenu(${i})">Hapus</button>
           </div>
         </div>`
      ).join('');
    }
    function hapusFotoMenu(i){ if(!confirm('Hapus foto menu?')) return; fotoMenuData.splice(i,1); localStorage.setItem('fotoMenuData',JSON.stringify(fotoMenuData)); renderFotoMenu(); showAlert('Foto menu dihapus','warning'); }
    function gantiFotoMenu(i){
      const input = document.createElement('input'); input.type='file'; input.accept='image/*';
      input.onchange = e => {
        const f = e.target.files[0]; if(!f) return;
        fileToDataURL(f, data => { fotoMenuData[i].foto = data; localStorage.setItem('fotoMenuData',JSON.stringify(fotoMenuData)); renderFotoMenu(); showAlert('Foto menu diganti'); });
      };
      input.click();
    }
    function editCaptionFotoMenu(i){
      const old = fotoMenuData[i].keterangan || '';
      const newc = prompt('Ubah keterangan foto menu (boleh multiline - gunakan \\n untuk baris baru):', old) || old;
      fotoMenuData[i].keterangan = newc;
      localStorage.setItem('fotoMenuData', JSON.stringify(fotoMenuData));
      renderFotoMenu();
      showAlert('Keterangan foto menu diperbarui','info');
    }

    // ---------- FOTO KEGIATAN (dgn keterangan) ----------
    const fotoKegiatanForm = document.getElementById('fotoKegiatanForm');
    fotoKegiatanForm.addEventListener('submit', e => {
      e.preventDefault();
      const f = document.getElementById('fotoKegiatanFile').files[0];
      const k = document.getElementById('fotoKegiatanCaption').value.trim();
      if (!f) return alert('Pilih file foto kegiatan');
      fileToDataURL(f, data => {
        fotoKegiatanData.unshift({ foto: data, keterangan: k });
        localStorage.setItem('fotoKegiatanData', JSON.stringify(fotoKegiatanData));
        renderFotoKegiatan();
        fotoKegiatanForm.reset();
        showAlert('Foto kegiatan ditambahkan');
      });
    });

    function renderFotoKegiatan() {
      const el = document.getElementById('fotoKegiatanList');
      if (!fotoKegiatanData.length) { el.innerHTML = '<p class="text-muted">Belum ada foto kegiatan.</p>'; return; }
      el.innerHTML = fotoKegiatanData.map((f,i) =>
        `<div class="col text-center">
           <img src="${f.foto}" class="thumb mb-2" alt="Foto Kegiatan ${i+1}">
           <div class="caption-small text-center">${escapeHtml(f.keterangan || '')}</div>
           <div class="mt-2">
             <button class="btn btn-sm btn-warning me-1" onclick="gantiFotoKegiatan(${i})">Ganti</button>
             <button class="btn btn-sm btn-secondary me-1" onclick="editCaptionFotoKegiatan(${i})">Edit Keterangan</button>
             <button class="btn btn-sm btn-danger" onclick="hapusFotoKegiatan(${i})">Hapus</button>
           </div>
         </div>`
      ).join('');
    }
    function hapusFotoKegiatan(i){ if(!confirm('Hapus foto kegiatan?')) return; fotoKegiatanData.splice(i,1); localStorage.setItem('fotoKegiatanData',JSON.stringify(fotoKegiatanData)); renderFotoKegiatan(); showAlert('Foto kegiatan dihapus','warning'); }
    function gantiFotoKegiatan(i){
      const input = document.createElement('input'); input.type='file'; input.accept='image/*';
      input.onchange = e => { const f = e.target.files[0]; if(!f) return; fileToDataURL(f, data => { fotoKegiatanData[i].foto = data; localStorage.setItem('fotoKegiatanData',JSON.stringify(fotoKegiatanData)); renderFotoKegiatan(); showAlert('Foto kegiatan diganti'); }); };
      input.click();
    }
    function editCaptionFotoKegiatan(i){
      const old = fotoKegiatanData[i].keterangan || '';
      const newc = prompt('Ubah keterangan foto kegiatan (\\n untuk baris baru):', old) || old;
      fotoKegiatanData[i].keterangan = newc;
      localStorage.setItem('fotoKegiatanData', JSON.stringify(fotoKegiatanData));
      renderFotoKegiatan();
      showAlert('Keterangan foto kegiatan diperbarui','info');
    }

    // ---------- SERTIFIKAT (dgn keterangan) ----------
    const sertifikatForm = document.getElementById('sertifikatForm');
    sertifikatForm.addEventListener('submit', e => {
      e.preventDefault();
      const f = document.getElementById('fotoSertifikat').files[0];
      const k = document.getElementById('fotoSertifikatCaption').value.trim();
      if (!f) return alert('Pilih file sertifikat');
      fileToDataURL(f, data => {
        sertifikatData.unshift({ foto: data, keterangan: k });
        localStorage.setItem('sertifikatData', JSON.stringify(sertifikatData));
        renderSertifikat();
        sertifikatForm.reset();
        showAlert('Sertifikat ditambahkan');
      });
    });

    function renderSertifikat() {
      const el = document.getElementById('sertifikatList');
      if (!el) return;
      if (!sertifikatData.length) { el.innerHTML = '<p class="text-muted">Belum ada sertifikat.</p>'; return; }
      el.innerHTML = sertifikatData.map((s,i)=>`
        <div class="col text-center">
          <img src="${s.foto}" class="certificate-img mb-2">
          <div class="caption-small text-center">${escapeHtml(s.keterangan || '')}</div>
          <div class="mt-2">
            <button class="btn btn-sm btn-warning me-1" onclick="gantiSertifikat(${i})">Ganti</button>
            <button class="btn btn-sm btn-secondary me-1" onclick="editCaptionSertifikat(${i})">Edit Keterangan</button>
            <button class="btn btn-sm btn-danger" onclick="hapusSertifikat(${i})">Hapus</button>
          </div>
        </div>`).join('');
    }
    function hapusSertifikat(i){ if(!confirm('Hapus sertifikat?')) return; sertifikatData.splice(i,1); localStorage.setItem('sertifikatData',JSON.stringify(sertifikatData)); renderSertifikat(); showAlert('Sertifikat dihapus','warning'); }
    function gantiSertifikat(i){ const input=document.createElement('input'); input.type='file'; input.accept='image/*'; input.onchange=e=>{ const f=e.target.files[0]; if(!f) return; fileToDataURL(f, data=>{ sertifikatData[i].foto=data; localStorage.setItem('sertifikatData',JSON.stringify(sertifikatData)); renderSertifikat(); showAlert('Sertifikat diganti'); }); }; input.click(); }
    function editCaptionSertifikat(i){ const old = sertifikatData[i].keterangan || ''; const newc = prompt('Ubah keterangan sertifikat (\\n untuk baris baru):', old) || old; sertifikatData[i].keterangan = newc; localStorage.setItem('sertifikatData', JSON.stringify(sertifikatData)); renderSertifikat(); showAlert('Keterangan sertifikat diperbarui','info'); }

    // ---------- Waitress ----------
    const waitressForm = document.getElementById('waitressForm');
    const waitressListEl = document.getElementById('waitressList');
    waitressForm.addEventListener('submit', e => {
      e.preventDefault();
      const name = document.getElementById('namaWaitress').value.trim();
      const file = document.getElementById('fotoWaitress').files[0];
      if (!name || !file) return alert('Nama dan foto required');
      fileToDataURL(file, data => {
        waitressData.unshift({ nama: name, foto: data });
        localStorage.setItem('waitressData', JSON.stringify(waitressData));
        renderWaitress();
        waitressForm.reset();
        showAlert('Waitress ditambahkan');
      });
    });

    function renderWaitress(){
      if(!waitressData.length){ waitressListEl.innerHTML = '<p class="text-muted">Belum ada waitress.</p>'; return; }
      waitressListEl.innerHTML = waitressData.map((w,i)=>`
        <div class="col text-center">
          <img src="${w.foto || 'https://via.placeholder.com/200x120?text=No+Image'}" class="thumb mb-2" alt="${w.nama}">
          <div><strong>${w.nama}</strong></div>
          <div class="mt-2">
            <button class="btn btn-sm btn-warning me-1" onclick="gantiWaitress(${i})">Ganti</button>
            <button class="btn btn-sm btn-danger" onclick="hapusWaitress(${i})">Hapus</button>
          </div>
        </div>`).join('');
    }
    function hapusWaitress(i){ if(!confirm('Hapus waitress?')) return; waitressData.splice(i,1); localStorage.setItem('waitressData',JSON.stringify(waitressData)); renderWaitress(); showAlert('Waitress dihapus','warning'); }
    function gantiWaitress(i){ const input=document.createElement('input'); input.type='file'; input.accept='image/*'; input.onchange=e=>{ const f=e.target.files[0]; if(!f) return; fileToDataURL(f, data=>{ waitressData[i].foto=data; localStorage.setItem('waitressData',JSON.stringify(waitressData)); renderWaitress(); showAlert('Foto waitress diganti'); }); }; input.click(); }

    // ---------- Anggota dapur ----------
    const anggotaForm = document.getElementById('anggotaForm');
    const anggotaListEl = document.getElementById('anggotaList');
    anggotaForm.addEventListener('submit', e => {
      e.preventDefault();
      const file = document.getElementById('fotoAnggota').files[0];
      if (!file) return alert('Pilih foto anggota');
      fileToDataURL(file, data => {
        anggotaData.unshift({ nama: document.getElementById('namaAnggota').value.trim(), jabatan: document.getElementById('jabatanAnggota').value, foto: data });
        localStorage.setItem('anggotaData', JSON.stringify(anggotaData));
        renderAnggota();
        anggotaForm.reset();
        showAlert('Anggota ditambahkan');
      });
    });
    function renderAnggota(){ if(!anggotaData.length){ anggotaListEl.innerHTML = '<p class="text-muted">Belum ada anggota dapur.</p>'; return; } anggotaListEl.innerHTML = anggotaData.map((a,i)=>`
      <div class="col">
        <div class="card h-100 text-center">
          <img src="${a.foto}" class="card-img-top" alt="${a.nama}">
          <div class="card-body">
            <h5 class="card-title">${a.nama}</h5>
            <p class="card-text text-muted">${a.jabatan}</p>
            <button class="btn btn-sm btn-danger" onclick="hapusAnggota(${i})">Hapus</button>
          </div>
        </div>
      </div>`).join(''); }
    function hapusAnggota(i){ if(!confirm('Hapus anggota?')) return; anggotaData.splice(i,1); localStorage.setItem('anggotaData',JSON.stringify(anggotaData)); renderAnggota(); showAlert('Anggota dihapus','warning'); }

    // ---------- Sertifikat render done above ----------

    // ---------- Keluhan ----------
    function renderKeluhan(){ const kL=document.getElementById('keluhanList'), kS=document.getElementById('keluhanSelesaiList'); kL.innerHTML = keluhanList.length ? keluhanList.map((k,i)=>`<li class='list-group-item d-flex justify-content-between align-items-start'><div><b>${k.text}</b><div class='small-muted'>${k.tanggal}</div></div><div><button class='btn btn-success btn-sm me-1' onclick='selesai(${i})'>✔</button><button class='btn btn-danger btn-sm' onclick='hapusKeluhan(${i})'>🗑</button></div></li>`).join('') : '<li class="list-group-item">Belum ada keluhan</li>'; kS.innerHTML = keluhanSelesai.length ? keluhanSelesai.map((k,i)=>`<li class='list-group-item d-flex justify-content-between align-items-start'><div><b>${k.text}</b><div class='small-muted'>${k.tanggal} ✓ ${k.selesaiTanggal}</div></div><button class='btn btn-danger btn-sm' onclick='hapusSelesai(${i})'>🗑</button></li>`).join('') : '<li class="list-group-item text-muted">Belum ada keluhan selesai</li>'; }
    function selesai(i){ const k = keluhanList.splice(i,1)[0]; k.selesaiTanggal = new Date().toLocaleString(); keluhanSelesai.unshift(k); localStorage.setItem('keluhanList', JSON.stringify(keluhanList)); localStorage.setItem('keluhanSelesai', JSON.stringify(keluhanSelesai)); renderKeluhan(); showAlert('Keluhan dipindahkan','success'); }
    function hapusKeluhan(i){ if(!confirm('Hapus keluhan?')) return; keluhanList.splice(i,1); localStorage.setItem('keluhanList', JSON.stringify(keluhanList)); renderKeluhan(); showAlert('Keluhan dihapus','warning'); }
    function hapusSelesai(i){ if(!confirm('Hapus keluhan selesai?')) return; keluhanSelesai.splice(i,1); localStorage.setItem('keluhanSelesai', JSON.stringify(keluhanSelesai)); renderKeluhan(); showAlert('Keluhan selesai dihapus','warning'); }

    // ---------- Utilities ----------
    function escapeHtml(s){ if(!s) return ''; return s.replaceAll('&','&amp;').replaceAll('<','&lt;').replaceAll('>','&gt;').replaceAll('"','&quot;'); }

    // Logout
    document.getElementById('logoutBtn').addEventListener('click', ()=> { if(confirm('Logout?')){ localStorage.removeItem('isLoggedIn'); location='index.html'; } });

	// ---------- Request Menu Konsumen ----------
	let requestMenuList = JSON.parse(localStorage.getItem('requestMenuList')) || [];

	function renderRequestMenuTable() {
	const tbody = document.getElementById('requestMenuTableBody');
	if (!tbody) return;
	if (!requestMenuList.length) {
    tbody.innerHTML = `<tr><td colspan="6" class="text-center text-muted">Belum ada request menu.</td></tr>`;
    return;
	}

	tbody.innerHTML = requestMenuList.map((r, i) => `
    <tr>
      <td>${r.tanggal}</td>
	  <td>${r.waktuMakan}</td>
      <td>${escapeHtml(r.lauk)}</td>
      <td>${escapeHtml(r.nasi)}</td>
      <td>${escapeHtml(r.tambahan || '-')}</td>
      <td>${escapeHtml(r.sayur || '-')}</td>
      <td class="text-center">
        <button class="btn btn-sm btn-success me-1" onclick="confirmRequest(${i})"><i class="fas fa-check"></i></button>
        <button class="btn btn-sm btn-danger" onclick="deleteRequest(${i})"><i class="fas fa-trash"></i></button>
      </td>
    </tr>
  `		).join('');
	}

	function confirmRequest(i) {
	requestMenuList[i].confirmed = true;
	localStorage.setItem('requestMenuList', JSON.stringify(requestMenuList));
	showAlert('Request dikonfirmasi!');
	renderRequestMenuTable();
	}

	function deleteRequest(i) {
	if (!confirm('Hapus request ini?')) return;
	requestMenuList.splice(i, 1);
	localStorage.setItem('requestMenuList', JSON.stringify(requestMenuList));
	renderRequestMenuTable();
	showAlert('Request dihapus', 'warning');
}
    // Initial render all
    function renderAll(){
	  renderRiwayat();
      renderFotoMenu();
      renderFotoKegiatan();
      renderSertifikat();
      renderWaitress();
      renderAnggota();
      renderKeluhan();
	  renderRequestMenuTable();
    }
    renderAll();

    // expose functions used inline
	window.editMenu = editMenu;
    window.hapusMenu = hapusMenu;
    window.hapusFotoMenu = hapusFotoMenu;
    window.gantiFotoMenu = gantiFotoMenu;
    window.editCaptionFotoMenu = editCaptionFotoMenu;
    window.hapusFotoKegiatan = hapusFotoKegiatan;
    window.gantiFotoKegiatan = gantiFotoKegiatan;
    window.editCaptionFotoKegiatan = editCaptionFotoKegiatan;
    window.hapusSertifikat = hapusSertifikat;
    window.gantiSertifikat = gantiSertifikat;
    window.editCaptionSertifikat = editCaptionSertifikat;
    window.hapusWaitress = hapusWaitress;
    window.gantiWaitress = gantiWaitress;
    window.hapusAnggota = hapusAnggota;
    window.editMenu = editMenu;
    window.hapusMenu = hapusMenu;
    window.selesai = selesai;
    window.hapusKeluhan = hapusKeluhan;
    window.hapusSelesai = hapusSelesai;
	window.confirmRequest = confirmRequest;
	window.deleteRequest = deleteRequest;

	
	

  </script>

  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>
